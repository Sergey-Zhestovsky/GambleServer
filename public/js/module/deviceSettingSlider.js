"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var DeviceSlider=function(){function v(t){var e=t.block,a=t.schema,i=void 0===a?{}:a,n=t.data,s=void 0===n?[]:n,c=t.dataSchema,d=void 0===c?{}:c,l=t.parentForm,o=t.onAdd,r=void 0===o?{}:o;_classCallCheck(this,v),this.block=e,this.schema=i,this.data=s,this.dataSchema={};var h=d.name;this.dataSchema.name=void 0===h?"name":h;var u=d.state;this.dataSchema.state=void 0===u?"state":u,this.parentForm=l,this.onAdd=r,this.blockList=[],this.deleteDataList=[],this.addButton,this.create()}return _createClass(v,[{key:"create",value:function(){var t=document.createDocumentFragment();0<this.data.length&&t.appendChild(this.uppendDataBlocks());this.addButton=$('\n\t\t\t<div class="popup-form_slider-block add-block" data-action="add">\n\t\t        <div class="popup-form_slider-add-button">\n\t\t            <i class="fa fa-plus" aria-hidden="true"></i>\n\t\t        </div>\n\t\t    </div>'),this.setAddEvent(this.addButton),t.appendChild(this.addButton.get(0)),this.block.html(t)}},{key:"setData",value:function(t){this.data=t,this.block.prepend(this.uppendDataBlocks())}},{key:"getData",value:function(){var t=[],e=!0,a=!1,i=void 0;try{for(var n,s=this.data[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var c=n.value;~this.deleteDataList.indexOf(c)||t.push(c)}}catch(t){a=!0,i=t}finally{try{e||null==s.return||s.return()}finally{if(a)throw i}}return t}},{key:"uppendDataBlocks",value:function(){var t,i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.data,n="relatedElement",a=function(e,a){$(e).on("change","input[type='checkbox']",function(t){e[n][a.state]=this.checked}).on("click","div[data-action='dalete']",function(t){i.setDeleteState(e,n)})},s=document.createDocumentFragment(),c=!0,d=!1,l=void 0;try{for(var o,r=e[Symbol.iterator]();!(c=(o=r.next()).done);c=!0){var h=o.value;(t=document.createElement("div")).classList.add("popup-form_slider-block"),t[n]=h;var u='\n\t\t\t<div class="popup-form_slider-block-header'.concat(this.schema.header&&this.schema.header.class?" ".concat(this.schema.header.class):"",'">\n\t\t\t\t<span>').concat(h[this.dataSchema.name],'</span>\n\t\t\t</div>\n            <div class="popup-form_slider-block-footer">\n                <label class="el-switch">\n                    <input type="checkbox" ').concat(h[this.dataSchema.state]?"checked":"",'>\n                    <span class="el-switch-style"></span>\n                </label>\n                <div class="popup-form_slider-delete-button" data-action="dalete">').concat(this.schema.delete&&this.schema.delete.value?this.schema.delete.value:"","</div>\n            </div>");t.innerHTML=u,a(t,this.dataSchema),s.appendChild(t),this.blockList.push(t)}}catch(t){d=!0,l=t}finally{try{c||null==r.return||r.return()}finally{if(d)throw l}}return s}},{key:"setDeleteState",value:function(e,a){var i=this;if(!~this.deleteDataList.indexOf(e[a])){var t='<div class="popup-form_slider-delete-wrapper">\n                        <div class="popup-form_slider-cancel-button" data-action="cancel">'.concat(this.schema.cancel&&this.schema.cancel.value?this.schema.cancel.value:"","</div>\n                    </div>"),n=$(t);n.one("click","div[data-action='cancel']",function(t){i.removeDeleteState(e,n,a)}),this.deleteDataList.push(e[a]),$(e).append(n)}}},{key:"removeDeleteState",value:function(t,e,a){e.addClass("hide"),setTimeout(function(){e.remove()},125),this.deleteDataList.splice(this.deleteDataList.indexOf(t[a]),1)}},{key:"clear",value:function(){var t=!(this.data=void 0),e=!1,a=void 0;try{for(var i,n=this.blockList[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var s=i.value;$(s).remove()}}catch(t){e=!0,a=t}finally{try{t||null==n.return||n.return()}finally{if(e)throw a}}this.blockList=[]}},{key:"setAddEvent",value:function(t){var a=this;t.on("click",function(){a.parentForm.openNestedElement(a.onAdd,function(t,e){t||a.addData(e)})})}},{key:"addData",value:function(t){t[this.dataSchema.state]=!0,this.data.push(t),this.addButton.before(this.uppendDataBlocks([t]))}}]),v}();exports.default=DeviceSlider;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL21vZHVsZS9kZXZpY2VTZXR0aW5nU2xpZGVyLmpzIl0sIm5hbWVzIjpbIkRldmljZVNsaWRlciIsIl9yZWYiLCJibG9jayIsIl9yZWYkc2NoZW1hIiwic2NoZW1hIiwiX3JlZiRkYXRhIiwiZGF0YSIsIl9yZWYkZGF0YVNjaGVtYSIsImRhdGFTY2hlbWEiLCJwYXJlbnRGb3JtIiwiX3JlZiRvbkFkZCIsIm9uQWRkIiwiX2NsYXNzQ2FsbENoZWNrIiwidGhpcyIsIl9kYXRhU2NoZW1hJG5hbWUiLCJuYW1lIiwiX2RhdGFTY2hlbWEkc3RhdGUiLCJzdGF0ZSIsImJsb2NrTGlzdCIsImRlbGV0ZURhdGFMaXN0IiwiYWRkQnV0dG9uIiwiZnJhZ21lbnQiLCJjcmVhdGVEb2N1bWVudEZyYWdtZW50IiwibGVuZ3RoIiwidXBwZW5kRGF0YUJsb2NrcyIsInNldEFkZEV2ZW50IiwiZ2V0IiwiY3JlYXRlIiwicmVzdWx0IiwiX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiIsIl9kaWRJdGVyYXRvckVycm9yIiwiX2l0ZXJhdG9yRXJyb3IiLCJ1bmRlZmluZWQiLCJfc3RlcCIsIl9pdGVyYXRvciIsImRvY3VtZW50IiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJuZXh0IiwiZG9uZSIsInZhbHVlIiwiaW5kZXhPZiIsImVyciIsInJldHVybiIsIl90aGlzIiwiYXJndW1lbnRzIiwidmFyaWFibGVOYW1lIiwic2V0QmxvY2tFdmVudHMiLCIkIiwib24iLCJlIiwiY2hlY2tlZCIsIl9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yIiwiX2RpZEl0ZXJhdG9yRXJyb3IyIiwiX2l0ZXJhdG9yRXJyb3IyIiwiX3N0ZXAyIiwiX2l0ZXJhdG9yMiIsImN1cnJlbnQiLCJvYmplY3QiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiaHRtbCIsImNvbmNhdCIsImhlYWRlciIsImNsYXNzIiwiZGVsZXRlIiwiaW5uZXJIVE1MIiwiYXBwZW5kQ2hpbGQiLCJwdXNoIiwiY2FuY2VsIiwiZWxlbWVudCIsIm9uZSIsIl90aGlzMiIsInJlbW92ZURlbGV0ZVN0YXRlIiwiYXBwZW5kIiwic2V0VGltZW91dCIsInJlbW92ZSIsInNwbGljZSIsIl9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zIiwiX2RpZEl0ZXJhdG9yRXJyb3IzIiwiX2l0ZXJhdG9yRXJyb3IzIiwiX3N0ZXAzIiwiX2l0ZXJhdG9yMyIsIl90aGlzMyIsImVycm9yIiwiYWRkRGF0YSIsImJlZm9yZSJdLCJtYXBwaW5ncyI6IkFBQUEscWVBRXFCQSx3QkFDcEIsU0FBQUEsRUFBQUMsR0FBc0YsSUFBekVDLEVBQXlFRCxFQUF6RUMsTUFBeUVDLEVBQUFGLEVBQWxFRyxPQUFBQSxPQUFrRSxJQUFBRCxFQUF6RCxHQUF5REEsRUFBQUUsRUFBQUosRUFBckRLLEtBQUFBLE9BQXFELElBQUFELEVBQTlDLEdBQThDQSxFQUFBRSxFQUFBTixFQUExQ08sV0FBQUEsT0FBMEMsSUFBQUQsRUFBN0IsR0FBNkJBLEVBQXpCRSxFQUF5QlIsRUFBekJRLFdBQXlCQyxFQUFBVCxFQUFiVSxNQUFBQSxPQUFhLElBQUFELEVBQUwsR0FBS0EsRUFBQUUsZ0JBQUFDLEtBQUFiLEdBQ3JGYSxLQUFLWCxNQUFRQSxFQUNiVyxLQUFLVCxPQUFTQSxFQUNkUyxLQUFLUCxLQUFPQSxFQUNaTyxLQUFLTCxXQUFhLEdBSm1FLElBQUFNLEVBUTNFTixFQUZBTyxLQUFNRixLQUFLTCxXQUFXTyxVQU5xRCxJQUFBRCxFQU05QyxPQU44Q0EsRUFBQSxJQUFBRSxFQVEzRVIsRUFEQVMsTUFBT0osS0FBS0wsV0FBV1MsV0FQb0QsSUFBQUQsRUFPNUMsUUFQNENBLEVBU3JGSCxLQUFLSixXQUFhQSxFQUNsQkksS0FYbUJiLE1BQUFBLEVBYW5CYSxLQUFLSyxVQUFZLEdBWmxCTCxLQUFBTSxlQUFBLEdBQXNGTixLQUFBTyxVQUFsRWhCLEtBQUFBLCtEQUFrRSxJQUFBaUIsRUFBMUNiLFNBQTBDYyx5QkFBQSxFQUFBVCxLQUFBUCxLQUFBaUIsUUFBQUYsRUFBYlYs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QixHQXpEdkJ1QixFQUFBQyxrQkFBQXhFLEVBQUFxRSxFQUFBekIsS0FnQlZqQyxLQUFBTSxlQUFBa0QsS0FBQW5FLEVBQUE0QyxJQUN2QjVDLEVBQUFBLEdBQUt5RSxPQUFHeEMsOENBSUFqQyxFQUFBcUUsRUFBQXpCLEdBa0JDekIsRUFBQUEsU0FBUytDLFFBQ1RRLFdBQUEsV0FDVEwsRUFBQU0sVUFKZVYsS0FyQ2tCdEQsS0FBQU0sZUFBQTJELE9BQUFqRSxLQUFBTSxlQUFBc0IsUUFBQXZDLEVBQUE0QyxJQUFBLG1DQUFBLElBQUFpQyxJQUFBbEUsS0FBQVAsVUFBQTBCLEdBQUFnRCxHQUFBLEVBQUFDLE9BQUFqRCxFQUFBLElBQUEsSUFBQSxJQUFBa0QsRUFBQUMsRUFBQXRFLEtBQUFLLFVBQUFrQixPQUFBQyxjQUFBMEMsR0FBQUcsRUFBQUMsRUFBQTdDLFFBQUFDLE1BQUF3QyxHQUFBLEVBQUEsQ0FBQSxJQUFBN0UsRUFBQWdGLEVBQUExQyxNQUFBUSxFQUFBOUMsR0FBQTJFLFVBQUEsTUFBQW5DLEdBQUFzQyxHQUFBLEVBQUFDLEVBQUF2QyxFQUFBLFFBQUEsSUFBQXFDLEdBQUEsTUFBQUksRUFBQXhDLFFBQUF3QyxFQUFBeEMsU0FBQSxRQUFBLEdBQUFxQyxFQUFBLE1BQUFDLEdBQUFwRSxLQUFBSyxVQUFBLHVDQUFBRSxHQUFBLElBQUFnRSxFQUFBdkUsS0FvRmxDTyxFQUFVNkIsR0FBRyxRQUFTLFdBekN0Qm1DLEVBQUEzRSxXQUFPWSxrQkFBUCtELEVBQUF6RSxNQUFBLFNBQUEwRSxFQUFBekQsR0FDQXlELEdBNkNFRCxFQUFLRSxRQUFRMUQsdUNBdkNmdEIsR0FPTWlFLEVBQUFBLEtBQUFBLFdBQVl0RCxRQUFTLEVBQ3BCSixLQUFBUCxLQUFBK0QsS0FBS0ssR0FDTDdELEtBRkRPLFVBQUFtRSxPQUFBMUUsS0FBQVcsaUJBQUEsQ0FBQWxCIiwiZmlsZSI6ImpzL21vZHVsZS9kZXZpY2VTZXR0aW5nU2xpZGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRGV2aWNlU2xpZGVyIHtcclxuXHRjb25zdHJ1Y3Rvcih7YmxvY2ssIHNjaGVtYSA9IHt9LCBkYXRhID0gW10sIGRhdGFTY2hlbWEgPSB7fSwgcGFyZW50Rm9ybSwgb25BZGQgPSB7fX0pIHtcclxuXHRcdHRoaXMuYmxvY2sgPSBibG9jaztcclxuXHRcdHRoaXMuc2NoZW1hID0gc2NoZW1hO1xyXG5cdFx0dGhpcy5kYXRhID0gZGF0YTtcclxuXHRcdHRoaXMuZGF0YVNjaGVtYSA9IHt9O1xyXG5cdFx0KHtcclxuICAgICAgICAgICAgbmFtZTogdGhpcy5kYXRhU2NoZW1hLm5hbWUgPSBcIm5hbWVcIixcclxuICAgICAgICAgICAgc3RhdGU6IHRoaXMuZGF0YVNjaGVtYS5zdGF0ZSA9IFwic3RhdGVcIlxyXG4gICAgICAgIH0gPSBkYXRhU2NoZW1hKTtcclxuXHRcdHRoaXMucGFyZW50Rm9ybSA9IHBhcmVudEZvcm07XHJcblx0XHR0aGlzLm9uQWRkID0gb25BZGQ7XHJcblxyXG5cdFx0dGhpcy5ibG9ja0xpc3QgPSBbXTtcclxuXHRcdHRoaXMuZGVsZXRlRGF0YUxpc3QgPSBbXTtcclxuXHRcdHRoaXMuYWRkQnV0dG9uO1xyXG5cclxuICAgICAgICB0aGlzLmNyZWF0ZSgpO1xyXG5cdH1cclxuXHJcblx0Y3JlYXRlKCkge1xyXG5cdFx0bGV0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xyXG5cclxuXHRcdGlmICh0aGlzLmRhdGEubGVuZ3RoID4gMClcclxuXHRcdFx0ZnJhZ21lbnQuYXBwZW5kQ2hpbGQoIHRoaXMudXBwZW5kRGF0YUJsb2NrcygpICk7XHJcblxyXG5cdFx0bGV0IGFkZEJ1dHRvbiA9IGBcclxuXHRcdFx0PGRpdiBjbGFzcz1cInBvcHVwLWZvcm1fc2xpZGVyLWJsb2NrIGFkZC1ibG9ja1wiIGRhdGEtYWN0aW9uPVwiYWRkXCI+XHJcblx0XHQgICAgICAgIDxkaXYgY2xhc3M9XCJwb3B1cC1mb3JtX3NsaWRlci1hZGQtYnV0dG9uXCI+XHJcblx0XHQgICAgICAgICAgICA8aSBjbGFzcz1cImZhIGZhLXBsdXNcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L2k+XHJcblx0XHQgICAgICAgIDwvZGl2PlxyXG5cdFx0ICAgIDwvZGl2PmA7XHJcblxyXG5cdCAgICB0aGlzLmFkZEJ1dHRvbiA9ICQoYWRkQnV0dG9uKTtcclxuXHQgICAgdGhpcy5zZXRBZGRFdmVudCh0aGlzLmFkZEJ1dHRvbik7XHJcblx0ICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKCB0aGlzLmFkZEJ1dHRvbi5nZXQoMCkgKTtcclxuXHQgICAgdGhpcy5ibG9jay5odG1sKGZyYWdtZW50KTtcclxuXHR9XHJcblxyXG5cdHNldERhdGEoZGF0YSkge1xyXG5cdFx0dGhpcy5kYXRhID0gZGF0YTsgXHJcblx0XHR0aGlzLmJsb2NrLnByZXBlbmQoIHRoaXMudXBwZW5kRGF0YUJsb2NrcygpICk7XHJcblx0fVxyXG5cclxuXHRnZXREYXRhKCkge1xyXG5cdFx0bGV0IHJlc3VsdCA9IFtdO1xyXG5cclxuXHRcdGZvcihsZXQgY3VycmVudCBvZiB0aGlzLmRhdGEpXHJcblx0XHRcdGlmICghfnRoaXMuZGVsZXRlRGF0YUxpc3QuaW5kZXhPZihjdXJyZW50KSlcclxuXHRcdFx0XHRyZXN1bHQucHVzaChjdXJyZW50KVxyXG5cclxuXHRcdHJldHVybiByZXN1bHQ7XHJcblx0fVxyXG5cclxuXHJcblx0dXBwZW5kRGF0YUJsb2NrcyhkYXRhID0gdGhpcy5kYXRhKSB7XHJcblx0XHRjb25zdCB2YXJpYWJsZU5hbWUgPSBcInJlbGF0ZWRFbGVtZW50XCI7XHJcblxyXG5cdFx0bGV0IHNldEJsb2NrRXZlbnRzID0gKGJsb2NrLCBkYXRhU2NoZW1hKSA9PiB7XHJcblx0XHRcdCQoYmxvY2spXHJcblx0XHRcdFx0Lm9uKFwiY2hhbmdlXCIsIFwiaW5wdXRbdHlwZT0nY2hlY2tib3gnXVwiLCBmdW5jdGlvbihlKSB7XHJcblx0XHRcdFx0XHRibG9ja1t2YXJpYWJsZU5hbWVdW2RhdGFTY2hlbWEuc3RhdGVdID0gdGhpcy5jaGVja2VkO1xyXG5cdFx0XHRcdH0pXHJcblx0XHRcdFx0Lm9uKFwiY2xpY2tcIiwgXCJkaXZbZGF0YS1hY3Rpb249J2RhbGV0ZSddXCIsIChlKSA9PiB7XHJcblx0XHRcdFx0XHR0aGlzLnNldERlbGV0ZVN0YXRlKGJsb2NrLCB2YXJpYWJsZU5hbWUpO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdGxldCBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSxcclxuXHRcdFx0YmxvY2s7XHJcblxyXG5cdFx0Zm9yKGxldCBvYmplY3Qgb2YgZGF0YSkge1xyXG5cdFx0XHRibG9jayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcblx0XHRcdGJsb2NrLmNsYXNzTGlzdC5hZGQoXCJwb3B1cC1mb3JtX3NsaWRlci1ibG9ja1wiKTtcclxuXHRcdFx0YmxvY2tbdmFyaWFibGVOYW1lXSA9IG9iamVjdDtcclxuXHJcblx0XHRcdGxldCBodG1sID0gYFxyXG5cdFx0XHQ8ZGl2IGNsYXNzPVwicG9wdXAtZm9ybV9zbGlkZXItYmxvY2staGVhZGVyJHtcclxuXHRcdFx0XHR0aGlzLnNjaGVtYS5oZWFkZXIgJiYgdGhpcy5zY2hlbWEuaGVhZGVyLmNsYXNzID8gYCAke3RoaXMuc2NoZW1hLmhlYWRlci5jbGFzc31gIDogXCJcIlxyXG5cdFx0XHR9XCI+XHJcblx0XHRcdFx0PHNwYW4+JHtvYmplY3RbdGhpcy5kYXRhU2NoZW1hLm5hbWVdfTwvc3Bhbj5cclxuXHRcdFx0PC9kaXY+XHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJwb3B1cC1mb3JtX3NsaWRlci1ibG9jay1mb290ZXJcIj5cclxuICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz1cImVsLXN3aXRjaFwiPlxyXG4gICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiAke29iamVjdFt0aGlzLmRhdGFTY2hlbWEuc3RhdGVdID8gXCJjaGVja2VkXCIgOiBcIlwifT5cclxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cImVsLXN3aXRjaC1zdHlsZVwiPjwvc3Bhbj5cclxuICAgICAgICAgICAgICAgIDwvbGFiZWw+XHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwicG9wdXAtZm9ybV9zbGlkZXItZGVsZXRlLWJ1dHRvblwiIGRhdGEtYWN0aW9uPVwiZGFsZXRlXCI+JHtcclxuICAgICAgICAgICAgICAgIFx0dGhpcy5zY2hlbWEuZGVsZXRlICYmIHRoaXMuc2NoZW1hLmRlbGV0ZS52YWx1ZSA/IHRoaXMuc2NoZW1hLmRlbGV0ZS52YWx1ZSA6IFwiXCJcclxuICAgICAgICAgICAgICAgIH08L2Rpdj5cclxuICAgICAgICAgICAgPC9kaXY+YDtcclxuXHJcbiAgICAgICAgICAgIGJsb2NrLmlubmVySFRNTCA9IGh0bWw7XHJcbiAgICAgICAgICAgIHNldEJsb2NrRXZlbnRzKGJsb2NrLCB0aGlzLmRhdGFTY2hlbWEpO1xyXG4gICAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChibG9jayk7XHJcbiAgICAgICAgICAgIHRoaXMuYmxvY2tMaXN0LnB1c2goYmxvY2spO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBmcmFnbWVudDtcclxuXHR9XHJcblxyXG5cdHNldERlbGV0ZVN0YXRlKGJsb2NrLCB2YXJpYWJsZU5hbWUpIHtcclxuXHRcdGlmICggfnRoaXMuZGVsZXRlRGF0YUxpc3QuaW5kZXhPZihibG9ja1t2YXJpYWJsZU5hbWVdKSApXHJcblx0XHRcdHJldHVybjtcclxuXHJcblx0XHRsZXQgaHRtbCA9IGA8ZGl2IGNsYXNzPVwicG9wdXAtZm9ybV9zbGlkZXItZGVsZXRlLXdyYXBwZXJcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInBvcHVwLWZvcm1fc2xpZGVyLWNhbmNlbC1idXR0b25cIiBkYXRhLWFjdGlvbj1cImNhbmNlbFwiPiR7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFx0dGhpcy5zY2hlbWEuY2FuY2VsICYmIHRoaXMuc2NoZW1hLmNhbmNlbC52YWx1ZSA/IHRoaXMuc2NoZW1hLmNhbmNlbC52YWx1ZSA6IFwiXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PmAsXHJcbiAgICAgICAgICAgIGVsZW1lbnQgPSAkKGh0bWwpO1xyXG5cclxuICAgICAgICBlbGVtZW50Lm9uZShcImNsaWNrXCIsIFwiZGl2W2RhdGEtYWN0aW9uPSdjYW5jZWwnXVwiLCAoZSkgPT4ge1xyXG4gICAgICAgIFx0dGhpcy5yZW1vdmVEZWxldGVTdGF0ZShibG9jaywgZWxlbWVudCwgdmFyaWFibGVOYW1lKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmRlbGV0ZURhdGFMaXN0LnB1c2goYmxvY2tbdmFyaWFibGVOYW1lXSk7XHJcbiAgICAgICAgJChibG9jaykuYXBwZW5kKGVsZW1lbnQpO1xyXG5cdH1cclxuXHJcblx0cmVtb3ZlRGVsZXRlU3RhdGUoYmxvY2ssIGVsZW1lbnQsIHZhcmlhYmxlTmFtZSkge1xyXG5cdFx0Y29uc3QgZGVsYXkgPSAxMjU7XHJcblxyXG5cdFx0ZWxlbWVudC5hZGRDbGFzcyhcImhpZGVcIik7XHJcblx0XHRzZXRUaW1lb3V0KCgpID0+IHtcclxuXHRcdFx0ZWxlbWVudC5yZW1vdmUoKTtcclxuXHRcdH0sIGRlbGF5KTtcclxuXHRcdHRoaXMuZGVsZXRlRGF0YUxpc3Quc3BsaWNlKCB0aGlzLmRlbGV0ZURhdGFMaXN0LmluZGV4T2YoYmxvY2tbdmFyaWFibGVOYW1lXSksIDEgKTtcclxuXHR9XHJcblxyXG5cdGNsZWFyKCkge1xyXG5cdFx0dGhpcy5kYXRhID0gdW5kZWZpbmVkO1xyXG5cclxuXHRcdGZvcihsZXQgYmxvY2sgb2YgdGhpcy5ibG9ja0xpc3QpXHJcblx0XHRcdCQoYmxvY2spLnJlbW92ZSgpO1xyXG5cclxuXHRcdHRoaXMuYmxvY2tMaXN0ID0gW107XHJcblx0fVxyXG5cclxuXHRzZXRBZGRFdmVudChhZGRCdXR0b24pIHtcclxuXHRcdGFkZEJ1dHRvbi5vbihcImNsaWNrXCIsICgpID0+IHtcclxuXHRcdFx0dGhpcy5wYXJlbnRGb3JtLm9wZW5OZXN0ZWRFbGVtZW50KHRoaXMub25BZGQsIChlcnJvciwgcmVzdWx0KSA9PiB7XHJcblx0XHRcdFx0aWYgKGVycm9yKVxyXG5cdFx0XHRcdFx0cmV0dXJuO1xyXG5cclxuXHRcdFx0XHR0aGlzLmFkZERhdGEocmVzdWx0KTtcclxuXHRcdFx0fSk7XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdGFkZERhdGEoZGF0YSkge1xyXG5cdFx0ZGF0YVt0aGlzLmRhdGFTY2hlbWEuc3RhdGVdID0gdHJ1ZTtcclxuXHRcdHRoaXMuZGF0YS5wdXNoKGRhdGEpO1xyXG5cdFx0dGhpcy5hZGRCdXR0b24uYmVmb3JlKHRoaXMudXBwZW5kRGF0YUJsb2NrcyhbZGF0YV0pKTtcclxuXHR9XHJcbn0iXX0=

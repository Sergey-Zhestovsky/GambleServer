"use strict";function _classCallCheck(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,s){for(var e=0;e<s.length;e++){var i=s[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,s,e){return s&&_defineProperties(t.prototype,s),e&&_defineProperties(t,e),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var PageController=function(){function f(t){var s=t.block,e=t.maxPages,i=t.schema,a=void 0===i?{}:i,o=t.buttonExpansion,c=void 0===o?1:o,n=t.currentPosition,r=void 0===n?1:n;_classCallCheck(this,f),this.block=s,this.maxPages=Math.max(e,1),this.schema={};var u=a.previous;this.schema.previous=void 0===u?{}:u;var h=a.next;this.schema.next=void 0===h?{}:h;var l=a.current;this.schema.current=void 0===l?{}:l;var v=a.defaultBlock;this.schema.defaultBlock=void 0===v?{}:v;var d=a.separator;this.schema.separator=void 0===d?{}:d,this.buttonExpansion=c,this.currentPosition=r,this.subscribeStack=new Set,this.create()}return _createClass(f,[{key:"create",value:function(t,s){this.setPageBlock(t,s),this.setListner()}},{key:"setPageBlock",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.currentPosition,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.maxPages;this.maxPages=s,this.CurrentPosition=t,this.block.html(this.constructButtons(this.createNumericButtons())),this.block.find("div[data-goto]").each(function(){this.goto=Number($(this).attr("data-goto"))})}},{key:"setListner",value:function(){var r,u=this,i=function t(s){var e=s.target;if(0!=u.subscribeStack.size){u.block.off("click","div[data-goto]",t),h.counter=u.subscribeStack.size,h.result=!0,r=e.goto;var i=!0,a=!1,o=void 0;try{for(var c,n=u.subscribeStack[Symbol.iterator]();!(i=(c=n.next()).done);i=!0){(0,c.value)(e.goto,h)}}catch(t){a=!0,o=t}finally{try{i||null==n.return||n.return()}finally{if(a)throw o}}}},h=function t(s,e){t.counter--,t.result=!s&&(t.result&&e),0==t.counter&&(t.result?u.create(r,t.result):u.block.on("click","div[data-goto]",i))};this.block.on("click","div[data-goto]",i)}},{key:"createNumericButtons",value:function(){for(var t=[],s=this.currentPosition-this.buttonExpansion<1?1:this.currentPosition-this.buttonExpansion,e=this.currentPosition+this.buttonExpansion>this.maxPages?this.maxPages:this.currentPosition+this.buttonExpansion,i=s;i<=e;i++)t.push(i);return t.includes(1)||(t=a([1],t)),t.includes(this.maxPages)||(t=a(t,[this.maxPages])),t;function a(t,s){return t[t.length-1]+1!==s[0]&&t.push(null),t.concat(s)}}},{key:"constructButtons",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],s="",e=this.schema.previous.class||this.schema.defaultBlock.class||"",i=this.schema.next.class||this.schema.defaultBlock.class||"";1==this.currentPosition?s+='<div class="'.concat(this.schema.separator.class||"",'">').concat(this.schema.previous.value||"Previous","</div>"):s+='<div class="'.concat(e,'" data-goto="').concat(this.currentPosition-1,'">').concat(this.schema.previous.value||"Previous","</div>");for(var a=0;a<t.length;a++)this.currentPosition==t[a]?s+='<div class="'.concat(this.schema.current.class||"",'">').concat(t[a],"</div>"):null==t[a]?s+='<div class="'.concat(this.schema.separator.class||"",'">').concat(this.schema.separator.value||"...","</div>"):s+='<div class="'.concat(this.schema.defaultBlock.class||"",'" data-goto="').concat(t[a],'">').concat(t[a],"</div>");return this.currentPosition==this.maxPages?s+='<div class="'.concat(this.schema.separator.class||"",'">').concat(this.schema.next.value||"Next","</div>"):s+='<div class="'.concat(i,'" data-goto="').concat(this.currentPosition+1,'">').concat(this.schema.next.value||"Next","</div>"),s}},{key:"subscribe",value:function(t){this.subscribeStack.add(t)}},{key:"unsubscribe",value:function(t){this.subscribeStack.delete(t)}},{key:"CurrentPosition",get:function(){return this.currentPosition},set:function(t){t>this.maxPages?this.currentPosition=this.maxPages:this.currentPosition=t}}]),f}();exports.default=PageController;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL21vZHVsZS9wYWdlQ29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJQYWdlQ29udHJvbGxlciIsIl9yZWYiLCJibG9jayIsIm1heFBhZ2VzIiwiX3JlZiRzY2hlbWEiLCJzY2hlbWEiLCJfcmVmJGJ1dHRvbkV4cGFuc2lvbiIsImJ1dHRvbkV4cGFuc2lvbiIsIl9yZWYkY3VycmVudFBvc2l0aW9uIiwiY3VycmVudFBvc2l0aW9uIiwiX2NsYXNzQ2FsbENoZWNrIiwidGhpcyIsIk1hdGgiLCJtYXgiLCJfc2NoZW1hJHByZXZpb3VzIiwicHJldmlvdXMiLCJfc2NoZW1hJG5leHQiLCJuZXh0IiwiX3NjaGVtYSRjdXJyZW50IiwiY3VycmVudCIsIl9zY2hlbWEkZGVmYXVsdEJsb2NrIiwiZGVmYXVsdEJsb2NrIiwiX3NjaGVtYSRzZXBhcmF0b3IiLCJzZXBhcmF0b3IiLCJzdWJzY3JpYmVTdGFjayIsIlNldCIsImNyZWF0ZSIsInNldExpc3RuZXIiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJjcmVhdGVOdW1lcmljQnV0dG9ucyIsImZpbmQiLCJlYWNoIiwiZ290byIsIk51bWJlciIsIiQiLCJhdHRyIiwic2V0UGFnZUJsb2NrIiwiX3RoaXMiLCJlIiwidGFyZ2V0Iiwic2l6ZSIsIm9mZiIsImxpc3RuZXIiLCJjb3VudGVyIiwiQ3VycmVudFBvc2l0aW9uIiwiaHRtbCIsImNvbnN0cnVjdEJ1dHRvbnMiLCJfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uIiwiX2RpZEl0ZXJhdG9yRXJyb3IiLCJfaXRlcmF0b3JFcnJvciIsIl9zdGVwIiwiX2l0ZXJhdG9yIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJkb25lIiwiY2IiLCJ2YWx1ZSIsInN1YnNjcmliZUNhbGxCYWNrIiwiZXJyIiwicmV0dXJuIiwiZXJyb3IiLCJyZXN1bHQiLCJnb1RvIiwib24iLCJhcnJheSIsImkiLCJtaW4iLCJwdXNoIiwiaW5jbHVkZXMiLCJjb25jYXRQYWdlQXJyYXkiLCJhcnIxIiwiYXJyMiIsInByZXZpb3VzQ2xhc3MiLCJjbGFzcyIsIm5leHRDbGFzcyIsImNvbmNhdCIsImFkZCIsImRlbGV0ZSIsInYiXSwibWFwcGluZ3MiOiJBQUFBLHFlQUVxQkEsMEJBQ2pCLFNBQUFBLEVBQUFDLEdBQXNGLElBQXpFQyxFQUF5RUQsRUFBekVDLE1BQU9DLEVBQWtFRixFQUFsRUUsU0FBa0VDLEVBQUFILEVBQXhESSxPQUFBQSxPQUF3RCxJQUFBRCxFQUEvQyxHQUErQ0EsRUFBQUUsRUFBQUwsRUFBM0NNLGdCQUFBQSxPQUEyQyxJQUFBRCxFQUF6QixFQUF5QkEsRUFBQUUsRUFBQVAsRUFBdEJRLGdCQUFBQSxPQUFzQixJQUFBRCxFQUFKLEVBQUlBLEVBQUFFLGdCQUFBQyxLQUFBWCxHQUNsRlcsS0FBS1QsTUFBUUEsRUFDYlMsS0FBS1IsU0FBV1MsS0FBS0MsSUFBSVYsRUFBVSxHQUNuQ1EsS0FBS04sT0FBUyxHQUhvRSxJQUFBUyxFQURyRWQsRUFNVGUsU0FBVUosS0FBS04sT0FBT1UsY0FMd0QsSUFBQUQsRUFLN0MsR0FMNkNBLEVBQUEsSUFBQUUsRUFEckVoQixFQU9UaUIsS0FBTU4sS0FBS04sT0FBT1ksVUFONEQsSUFBQUQsRUFNckQsR0FOcURBLEVBQUEsSUFBQUUsRUFEckVsQixFQVFUbUIsUUFBU1IsS0FBS04sT0FBT2MsYUFQeUQsSUFBQUQsRUFPL0MsR0FQK0NBLEVBQUEsSUFBQUUsRUFEckVwQixFQVNUcUIsYUFBY1YsS0FBS04sT0FBT2dCLGtCQVJvRCxJQUFBRCxFQVFyQyxHQVJxQ0EsRUFBQSxJQUFBRSxFQURyRXRCLEVBVVR1QixVQUFXWixLQUFLTixPQUFPa0IsZUFUdUQsSUFBQUQsRUFTM0MsR0FUMkNBLEVBV2xGWCxLQUFLSixnQkFBa0JBLEVBQ3ZCSSxLQUFLRixnQkFBa0JBLEVBWmRQLEtBQXlFc0IsZUFBQSxJQUFBQyxJQUFBZCxLQUFBZSw2REFBQWpCLEVBQUFOLEdBTXhFUSxLQUFLTixhQU5tRUksRUFBQU4sR0FBQVEsS0FBQWdCLG9EQUFBLElBUXBETixFQVJvRCxFQUFBTyxVQUFBQyxhQUFBQyxJQUFBRixVQUFBLEdBQUFBLFVBQUEsR0FBQWpCLEtBQUFGLGdCQUFBTixFQUFBLEVBQUF5QixVQUFBQyxhQUFBQyxJQUFBRixVQUFBLEdBQUFBLFVBQUEsR0FBQWpCLEtBQUFSLFNBQUFRLEtBQUFSLFNBQUFBLEVBU25FUSxLQUFLTixnQkFUOERJLEVBWWxGRSxLQUFLRixNQUFBQSxLQUFMRSxLQUF1QkYsaUJBQXZCRSxLQUFBb0IseUJBSUFwQixLQUFLZSxNQUFMTSxLQUFBLGtCQUFBQyxLQUFBLFdBQ0h0QixLQUFBdUIsS0FBQUMsT0FBQUMsRUFBQXpCLE1BQUEwQixLQUFBLHFEQTZCYSxJQWZMQyxFQWVLQyxFQUFBNUIsS0FkTGdCLEVBQUwsU0FBS0EsRUFBTGEsR0FDSCxJQUFBckIsRUFBQXFCLEVBQUFDLE9Ba0JPLEdBQWdDLEdBQTVCRixFQUFLZixlQUFla0IsS0FBeEIsQ0FoQjZDdkMsRUFBQUEsTUFBMEJ3QyxJQUFBLFFBQUEsaUJBQUFDLEdBQ3RFekMsRUFBTDBDLFFBQUFOLEVBQUFmLGVBQUFrQixLQUNLSSxFQUFrQnJDLFFBQUFBLEVBRWxCUCxFQUFNNkMsRUFBV0MsS0FQdEIsSUFBQUMsR0FBQSxFQUFBQyxHQUFBLEVBQUFDLE9BQUFyQixFQUFBLElBVUksSUFBQSxJQUFBc0IsRUFBQUMsRUFBa0JkLEVBQUdmLGVBQXJCOEIsT0FBQUMsY0FBQU4sR0FBQUcsRUFBQUMsRUFBQXBDLFFBQUF1QyxNQUFBUCxHQUFBLEVBQWdDLEVBRHBDUSxFQUNvQ0wsRUFBQU0sT0FEcEN2QyxFQUFBZSxLQUFBeUIsSUFUQSxNQUFBQyxHQUFBVixHQUFBLEVBQUFDLEVBQUFTLEVBQUEsUUFBQSxJQUFBWCxHQUFBLE1BQUFJLEVBQUFRLFFBQUFSLEVBQUFRLFNBQUEsUUFBQSxHQUFBWCxFQUFBLE1BQUFDLE1BK0JJUSxFQUFvQixTQUFwQkEsRUFBcUJHLEVBQU9DLEdBQzVCSixFQUFrQmQsVUFqQnRCYyxFQUFBSSxRQW1CUUQsSUFsQmFILEVBQUFJLFFBQUFBLEdBSWIsR0FEQUosRUFBb0JqQixVQXFCaEJpQixFQUFrQkksT0FsQmZwQixFQUFJakIsT0FBZnNDLEVBQXdCTCxFQUFrQmYsUUFDMUNlLEVBQWlCekQsTUFBQzJDLEdBQWxCLFFBQWlDckIsaUJBQWpDb0IsS0FQaUJqQyxLQUFBVCxNQUFBK0QsR0FBQSxRQUFBLGlCQUFBckIsa0RBQUEsSUFXa0IsSUFBQXNCLEVBQUEsR0FDL0JULEVBQUd0QyxLQUFRZSxnQkFBTXlCLEtBQWpCcEQsZ0JBQUEsRUFDSCxFQWJnQkksS0FBQUYsZ0JBQUFFLEtBQUFKLGdCQUFBTSxFQUFBRixLQUFBRixnQkFBQUUsS0FBQUosZ0JBQUFJLEtBQUFSLFNBQUFRLEtBQUFSLFNBQUFRLEtBQUFGLGdCQUFBRSxLQUFBSixnQkFBQTRELEVBQUFDLEVBQUFELEdBQUF0RCxFQUFBc0QsSUFBQUQsRUFBQUcsS0FBQUYsR0FnQmpCUixPQWhCaUJPLEVBQUFJLFNBQUEsS0FBQUosRUFBQUssRUFBQSxDQUFBLEdBQUFMLElBQUFBLEVBQUFJLFNBQUEzRCxLQUFBUixZQUFyQitELEVBQUFLLEVBQUFMLEVBQUEsQ0FBQXZELEtBQUFSLFlBZ0JJd0QsRUEwQ0osU0FBU1ksRUFBZ0JDLEVBQU1DLEdBL0JuQixPQUpKZCxFQUFBQSxFQUFBQSxPQUFrQmQsR0FBbEIsSUFBZ0M0QixFQUFBLElBQzVCZCxFQUFBQSxLQUFBQSxNQUdLekQsRUFBTStELE9BQUdRLCtDQXdDQSxJQUFaUCxFQUFZLEVBQUF0QyxVQUFBQyxhQUFBQyxJQUFBRixVQUFBLEdBQUFBLFVBQUEsR0FBSixHQW5DakIxQixFQUFMLEdBQ0h3RSxFQUFBL0QsS0FBQU4sT0FBQVUsU0FBQTRELE9BQUFoRSxLQUFBTixPQUFBZ0IsYUFBQXNELE9BQUEsR0FxQ09DLEVBQVlqRSxLQUFLTixPQUFPWSxLQUFLMEQsT0FBU2hFLEtBQUtOLE9BQU9nQixhQUFhc0QsT0FBUyxHQUVoRCxHQUF4QmhFLEtBQUtGLGdCQXBDTHlELEdBQUssZUFBQVcsT0FBVGxFLEtBQUFOLE9BQUFrQixVQUFBb0QsT0FBQSxHQUFTLE1BQUFFLE9BQVRsRSxLQUFBTixPQUFBVSxTQUFBMkMsT0FBQSxXQUFTLFVBSUw3QyxHQUFPLGVBQUFnRSxPQUFLcEUsRUFBTCxpQkFBQW9FLE9BQStDbEUsS0FBS1IsZ0JBQ3BEQSxFQURBLE1BQUEwRSxPQUFEbEUsS0FFSE4sT0FBS0ksU0FBTGlELE9BQTRCbkQsV0FGeEIsVUFLUDJELElBQUssSUFBQ0csRUFBTixFQUFBRixFQUFBRCxFQUFBckMsT0FBQXNDLElBQ0h4RCxLQUFBRixpQkFBQXlELEVBQUFDLEdBa0NPcEIsR0FBSSxlQUFBOEIsT0FBbUJsRSxLQUFLTixPQUFPYyxRQUFRd0QsT0FBUyxHQUFoRCxNQUFBRSxPQUF1RFgsRUFBTUMsR0FBN0QsVUFoQ1ksTUFBYkcsRUFBWEgsR0FDWUksR0FBQUEsZUFBQUEsT0FBcUJMLEtBQTdCN0QsT0FBQWtCLFVBQUFvRCxPQUFBLEdBQVFKLE1BQUFBLE9BQVI1RCxLQUFBTixPQUFBa0IsVUFBQW1DLE9BQUEsTUFBUWEsVUFtQ0p4QixHQUFJLGVBQUE4QixPQUFtQmxFLEtBQUtOLE9BQU9nQixhQUFhc0QsT0FBUyxHQUFyRCxpQkFBQUUsT0FBdUVYLEVBQU1DLEdBQTdFLE1BQUFVLE9BQW9GWCxFQUFNQyxHQUExRixVQVdaLE9BUEl4RCxLQUFLRixpQkFBbUJFLEtBQUtSLFNBaENqQzRDLEdBQU9tQixlQUFBQSxPQUFQdkQsS0FBQU4sT0FBQWtCLFVBQUFvRCxPQUFBLEdBQU9ULE1BQUFBLE9BQVB2RCxLQUFBTixPQUFBWSxLQUFBeUMsT0FBQSxPQUFPUSxVQUVQbkIsR0FBU3dCLGVBQUFBLE9BQVRLLEVBQVNMLGlCQUFBQSxPQUE0QjVELEtBQUFGLGdCQUFBLEVBQTVCOEQsTUFBQUEsT0FBNEI1RCxLQUFBTixPQUFBWSxLQUFBeUMsT0FBQSxPQUE1QmEsVUFxQ0Z4QixvQ0E5QlZVLEdBa0NHOUMsS0FBS2EsZUFBZXNELElBQUlyQix1Q0FoQ0VBLEdBQzFCOUMsS0FBSW9DLGVBQUpnQyxPQUFBdEIsMkNBcEhrRixPQUFBOUMsS0FBQUYsOEJBQUF1RSxHQXdCOUVBLEVBQUlyRSxLQUFLUixTQXZCUkQsS0FBUUEsZ0JBQWJTLEtBQUFSLFNBRUtFLEtBQUxJLGdCQUFBdUUiLCJmaWxlIjoianMvbW9kdWxlL3BhZ2VDb250cm9sbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGFnZUNvbnRyb2xsZXIge1xyXG4gICAgY29uc3RydWN0b3Ioe2Jsb2NrLCBtYXhQYWdlcywgc2NoZW1hID0ge30sIGJ1dHRvbkV4cGFuc2lvbiA9IDEsIGN1cnJlbnRQb3NpdGlvbiA9IDF9KSB7XHJcbiAgICAgICAgdGhpcy5ibG9jayA9IGJsb2NrO1xyXG4gICAgICAgIHRoaXMubWF4UGFnZXMgPSBNYXRoLm1heChtYXhQYWdlcywgMSk7XHJcbiAgICAgICAgdGhpcy5zY2hlbWEgPSB7fTtcclxuICAgICAgICAoe1xyXG4gICAgICAgICAgICBwcmV2aW91czogdGhpcy5zY2hlbWEucHJldmlvdXMgPSB7fSxcclxuICAgICAgICAgICAgbmV4dDogdGhpcy5zY2hlbWEubmV4dCA9IHt9LFxyXG4gICAgICAgICAgICBjdXJyZW50OiB0aGlzLnNjaGVtYS5jdXJyZW50ID0ge30sXHJcbiAgICAgICAgICAgIGRlZmF1bHRCbG9jazogdGhpcy5zY2hlbWEuZGVmYXVsdEJsb2NrID0ge30sXHJcbiAgICAgICAgICAgIHNlcGFyYXRvcjogdGhpcy5zY2hlbWEuc2VwYXJhdG9yID0ge31cclxuICAgICAgICB9ID0gc2NoZW1hKTtcclxuICAgICAgICB0aGlzLmJ1dHRvbkV4cGFuc2lvbiA9IGJ1dHRvbkV4cGFuc2lvbjtcclxuICAgICAgICB0aGlzLmN1cnJlbnRQb3NpdGlvbiA9IGN1cnJlbnRQb3NpdGlvbjtcclxuXHJcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVTdGFjayA9IG5ldyBTZXQoKTtcclxuXHJcbiAgICAgICAgdGhpcy5jcmVhdGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgQ3VycmVudFBvc2l0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQb3NpdGlvbjtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgQ3VycmVudFBvc2l0aW9uKHYpIHtcclxuICAgICAgICBpZiAodiA+IHRoaXMubWF4UGFnZXMpXHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFBvc2l0aW9uID0gdGhpcy5tYXhQYWdlcztcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFBvc2l0aW9uID0gdjtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGUgKGN1cnJlbnRQb3NpdGlvbiwgbWF4UGFnZXMpIHtcclxuICAgICAgICB0aGlzLnNldFBhZ2VCbG9jayhjdXJyZW50UG9zaXRpb24sIG1heFBhZ2VzKTtcclxuICAgICAgICB0aGlzLnNldExpc3RuZXIoKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRQYWdlQmxvY2soY3VycmVudFBvc2l0aW9uID0gdGhpcy5jdXJyZW50UG9zaXRpb24sIG1heFBhZ2VzID0gdGhpcy5tYXhQYWdlcykge1xyXG4gICAgICAgIHRoaXMubWF4UGFnZXMgPSBtYXhQYWdlcztcclxuICAgICAgICB0aGlzLkN1cnJlbnRQb3NpdGlvbiA9IGN1cnJlbnRQb3NpdGlvbjtcclxuXHJcbiAgICAgICAgdGhpcy5ibG9jay5odG1sKCB0aGlzLmNvbnN0cnVjdEJ1dHRvbnModGhpcy5jcmVhdGVOdW1lcmljQnV0dG9ucygpKSApO1xyXG5cclxuICAgICAgICB0aGlzLmJsb2NrLmZpbmQoXCJkaXZbZGF0YS1nb3RvXVwiKS5lYWNoKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB0aGlzLmdvdG8gPSBOdW1iZXIoJCh0aGlzKS5hdHRyKFwiZGF0YS1nb3RvXCIpKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRMaXN0bmVyICgpIHtcclxuICAgICAgICBsZXQgZ29UbztcclxuICAgICAgICBsZXQgbGlzdG5lciA9IChlKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBjdXJyZW50ID0gZS50YXJnZXQ7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5zdWJzY3JpYmVTdGFjay5zaXplID09IDApXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB0aGlzLmJsb2NrLm9mZihcImNsaWNrXCIsIFwiZGl2W2RhdGEtZ290b11cIiwgbGlzdG5lcik7XHJcbiAgICAgICAgICAgIHN1YnNjcmliZUNhbGxCYWNrLmNvdW50ZXIgPSB0aGlzLnN1YnNjcmliZVN0YWNrLnNpemU7XHJcbiAgICAgICAgICAgIHN1YnNjcmliZUNhbGxCYWNrLnJlc3VsdCA9IHRydWU7XHJcbiAgICAgICAgICAgIGdvVG8gPSBjdXJyZW50LmdvdG87XHJcblxyXG4gICAgICAgICAgICBmb3IobGV0IGNiIG9mIHRoaXMuc3Vic2NyaWJlU3RhY2spIHtcclxuICAgICAgICAgICAgICAgIGNiKGN1cnJlbnQuZ290bywgc3Vic2NyaWJlQ2FsbEJhY2spO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBsZXQgc3Vic2NyaWJlQ2FsbEJhY2sgPSAoZXJyb3IsIHJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICBzdWJzY3JpYmVDYWxsQmFjay5jb3VudGVyLS07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAoZXJyb3IpXHJcbiAgICAgICAgICAgICAgICBzdWJzY3JpYmVDYWxsQmFjay5yZXN1bHQgPSBmYWxzZTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgc3Vic2NyaWJlQ2FsbEJhY2sucmVzdWx0ID0gc3Vic2NyaWJlQ2FsbEJhY2sucmVzdWx0ICYmIHJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgIGlmIChzdWJzY3JpYmVDYWxsQmFjay5jb3VudGVyID09IDApIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdWJzY3JpYmVDYWxsQmFjay5yZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZShnb1RvLCBzdWJzY3JpYmVDYWxsQmFjay5yZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJsb2NrLm9uKFwiY2xpY2tcIiwgXCJkaXZbZGF0YS1nb3RvXVwiLCBsaXN0bmVyKTtcclxuICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLmJsb2NrLm9uKFwiY2xpY2tcIiwgXCJkaXZbZGF0YS1nb3RvXVwiLCBsaXN0bmVyKTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVOdW1lcmljQnV0dG9ucyAoKSB7XHJcbiAgICAgICAgbGV0IGFycmF5ID0gW10sXHJcbiAgICAgICAgICAgIG1pbiA9ICh0aGlzLmN1cnJlbnRQb3NpdGlvbiAtIHRoaXMuYnV0dG9uRXhwYW5zaW9uKSA8IDEgXHJcbiAgICAgICAgICAgID8gMSBcclxuICAgICAgICAgICAgOiAodGhpcy5jdXJyZW50UG9zaXRpb24gLSB0aGlzLmJ1dHRvbkV4cGFuc2lvbiksXHJcbiAgICAgICAgICAgIG1heCA9ICh0aGlzLmN1cnJlbnRQb3NpdGlvbiArIHRoaXMuYnV0dG9uRXhwYW5zaW9uKSA+IHRoaXMubWF4UGFnZXMgXHJcbiAgICAgICAgICAgID8gdGhpcy5tYXhQYWdlcyBcclxuICAgICAgICAgICAgOiAodGhpcy5jdXJyZW50UG9zaXRpb24gKyB0aGlzLmJ1dHRvbkV4cGFuc2lvbik7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSBtaW47IGkgPD0gbWF4OyBpKyspIHtcclxuICAgICAgICAgICAgYXJyYXkucHVzaChpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghYXJyYXkuaW5jbHVkZXMoMSkpIHtcclxuICAgICAgICAgICAgYXJyYXkgPSBjb25jYXRQYWdlQXJyYXkoWzFdLCBhcnJheSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIWFycmF5LmluY2x1ZGVzKHRoaXMubWF4UGFnZXMpKSB7XHJcbiAgICAgICAgICAgIGFycmF5ID0gY29uY2F0UGFnZUFycmF5KGFycmF5LCBbdGhpcy5tYXhQYWdlc10pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGFycmF5O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjb25jYXRQYWdlQXJyYXkoYXJyMSwgYXJyMikge1xyXG4gICAgICAgICAgICBpZiAoYXJyMVthcnIxLmxlbmd0aCAtIDFdICsgMSAhPT0gYXJyMlswXSkge1xyXG4gICAgICAgICAgICAgICAgYXJyMS5wdXNoKG51bGwpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gYXJyMS5jb25jYXQoYXJyMik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdEJ1dHRvbnMgKGFycmF5ID0gW10pIHtcclxuICAgICAgICBsZXQgaHRtbCA9ICcnLFxyXG4gICAgICAgICAgICBwcmV2aW91c0NsYXNzID0gdGhpcy5zY2hlbWEucHJldmlvdXMuY2xhc3MgfHwgdGhpcy5zY2hlbWEuZGVmYXVsdEJsb2NrLmNsYXNzIHx8IFwiXCIsXHJcbiAgICAgICAgICAgIG5leHRDbGFzcyA9IHRoaXMuc2NoZW1hLm5leHQuY2xhc3MgfHwgdGhpcy5zY2hlbWEuZGVmYXVsdEJsb2NrLmNsYXNzIHx8IFwiXCI7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRQb3NpdGlvbiA9PSAxKSB7XHJcbiAgICAgICAgICAgIGh0bWwgKz0gYDxkaXYgY2xhc3M9XCIke3RoaXMuc2NoZW1hLnNlcGFyYXRvci5jbGFzcyB8fCBcIlwifVwiPiR7dGhpcy5zY2hlbWEucHJldmlvdXMudmFsdWUgfHwgXCJQcmV2aW91c1wifTwvZGl2PmA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz1cIiR7cHJldmlvdXNDbGFzc31cIiBkYXRhLWdvdG89XCIke3RoaXMuY3VycmVudFBvc2l0aW9uIC0gMX1cIj4ke3RoaXMuc2NoZW1hLnByZXZpb3VzLnZhbHVlIHx8IFwiUHJldmlvdXNcIn08L2Rpdj5gO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRQb3NpdGlvbiA9PSBhcnJheVtpXSkge1xyXG4gICAgICAgICAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz1cIiR7dGhpcy5zY2hlbWEuY3VycmVudC5jbGFzcyB8fCBcIlwifVwiPiR7YXJyYXlbaV19PC9kaXY+YFxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFycmF5W2ldID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGh0bWwgKz0gYDxkaXYgY2xhc3M9XCIke3RoaXMuc2NoZW1hLnNlcGFyYXRvci5jbGFzcyB8fCBcIlwifVwiPiR7dGhpcy5zY2hlbWEuc2VwYXJhdG9yLnZhbHVlIHx8IFwiLi4uXCJ9PC9kaXY+YDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGh0bWwgKz0gYDxkaXYgY2xhc3M9XCIke3RoaXMuc2NoZW1hLmRlZmF1bHRCbG9jay5jbGFzcyB8fCBcIlwifVwiIGRhdGEtZ290bz1cIiR7YXJyYXlbaV19XCI+JHthcnJheVtpXX08L2Rpdj5gO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50UG9zaXRpb24gPT0gdGhpcy5tYXhQYWdlcykge1xyXG4gICAgICAgICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPVwiJHt0aGlzLnNjaGVtYS5zZXBhcmF0b3IuY2xhc3MgfHwgXCJcIn1cIj4ke3RoaXMuc2NoZW1hLm5leHQudmFsdWUgfHwgXCJOZXh0XCJ9PC9kaXY+YDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPVwiJHtuZXh0Q2xhc3N9XCIgZGF0YS1nb3RvPVwiJHt0aGlzLmN1cnJlbnRQb3NpdGlvbiArIDF9XCI+JHt0aGlzLnNjaGVtYS5uZXh0LnZhbHVlIHx8IFwiTmV4dFwifTwvZGl2PmA7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcmV0dXJuIGh0bWw7XHJcbiAgICB9XHJcblxyXG4gICAgc3Vic2NyaWJlKGNiKSB7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVTdGFjay5hZGQoY2IpO1xyXG4gICAgfVxyXG5cclxuICAgIHVuc3Vic2NyaWJlKGNiKSB7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVTdGFjay5kZWxldGUoY2IpO1xyXG4gICAgfVxyXG59Il19

"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _customSelector=_interopRequireDefault(require("/js/module/customSelector.js")),_pageController=_interopRequireDefault(require("/js/module/pageController.js")),_popupForm=_interopRequireDefault(require("/js/module/popupForm.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}var TableController=function(){function f(e){var t=e.selector,a=e.pages,n=e.editForm,r=e.block,l=e.loader,o=e.addButton,i=void 0!==o&&o,c=e.schema,s=e.dbLength,d=void 0===s?0:s,u=e.data,h=void 0===u?[]:u,v=e.connector;_classCallCheck(this,f),this.selector=t,this.pages=a,this.editForm=n,this.block=r,this.loader=l,this.addButton=i,this.schema=c,this.dbLength=d,this.data=h,this.SelectorBlock=new _customSelector.default(this.selector),this.pages.maxPages=this.calculatePages(),this.PageControllerBlock=new _pageController.default(this.pages),this.editForm&&(this.editForm.connector=v,this.PopupFormBlock=new _popupForm.default(this.editForm)),this.eventListner=new Map,this.setSelectorEvent(),this.setPageEvent(),this.create()}return _createClass(f,[{key:"create",value:function(){this.createHead(),this.createBody(),this.setAddEvent(),this.triggerTableCreate()}},{key:"calculatePages",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.dbLength,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.SelectorBlock.getSetValue();return Math.ceil(e/t)}},{key:"calculatePadding",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.SelectorBlock.getSetValue();return((1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.PageControllerBlock.CurrentPosition)-1)*e}},{key:"createHead",value:function(){0==this.block.find("thead").length&&this.block.html("<thead></thead>");var e=this.block.find("thead"),t="",a=!0,n=!1,r=void 0;try{for(var l,o=this.schema.columns[Symbol.iterator]();!(a=(l=o.next()).done);a=!0){var i=l.value;t+='<td class="'.concat(i.class||"",'">').concat(i.value,"</td>")}}catch(e){n=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(n)throw r}}e.html(t)}},{key:"getRelatedData",value:function(e,t){if(!Array.isArray(t))return e[t];var a=e,n=!0,r=!1,l=void 0;try{for(var o,i=t[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){a=a[o.value]||""}}catch(e){r=!0,l=e}finally{try{n||null==i.return||i.return()}finally{if(r)throw l}}return a}},{key:"createBody",value:function(e){this.block.find("tbody").html(this.generateBody(e))}},{key:"addToBody",value:function(e){this.block.find("tbody").append(this.generateBody([e]))}},{key:"deleteFromBody",value:function(e){e.remove()}},{key:"updateBody",value:function(e,t){for(var a=this.schema.columns,n=0;n<a.length;n++)a[n].relatedData&&e.find("td:eq(".concat(n,")")).text(this.getRelatedData(t,a[n].relatedData))}},{key:"generateBody",value:function(){var i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.data;if(void 0!==e&&0!==e.length){var t="relatedElement",a=function(e,t,a,n){if(a.autoIncrement)return t+1;if(a.buttons){for(var r="",l=0;l<a.buttons.length;l++){var o=n.buttons[a.buttons[l]];r+='<div class="'.concat(o.class,'" data-action="').concat(o.action,'">').concat(o.name,"</div>")}return r}return a.relatedData?i.getRelatedData(e,a.relatedData):void 0};0==this.block.find("tbody").length&&this.block.html("<tbody></tbody>");for(var n,r=document.createDocumentFragment(),l=0;l<e.length;l++){var o=e[l],c="";(n=document.createElement("tr"))[t]=o;var s=!0,d=!1,u=void 0;try{for(var h,v=this.schema.columns[Symbol.iterator]();!(s=(h=v.next()).done);s=!0){var f=h.value;c+='<td class="'.concat(f.class||"",'" ').concat(f.relatedData?'data-title="'.concat(f.value,'"'):"",">").concat(a(o,l,f,this.schema),"</td>")}}catch(e){d=!0,u=e}finally{try{s||null==v.return||v.return()}finally{if(d)throw u}}n.innerHTML=c,this.setBtnEvent($(n),"data-action",t),r.appendChild(n)}return r}}},{key:"normalizeTable",value:function(){for(var t=this.block.find("tbody"),e=this.schema.columns,a=0;a<e.length;a++)e[a].autoIncrement&&function(){var e=1;t.find("tr > td:first-child").each(function(){$(this).text(e++)})}()}},{key:"triggerEvent",value:function(e){if(this.eventListner.has(e)){for(var t=arguments.length,a=new Array(1<t?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];var r=!0,l=!1,o=void 0;try{for(var i,c=this.eventListner.get(e)[Symbol.iterator]();!(r=(i=c.next()).done);r=!0){i.value.apply(void 0,a)}}catch(e){l=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(l)throw o}}}}},{key:"triggerGetEvent",value:function(e,t,a){this.eventListner.has("get")&&(this.block.addClass("loading"),this.triggerEvent("get",{length:e,padding:t},a))}},{key:"setAddEvent",value:function(){var a=this;this.addButton&&this.addButton.on("click",function(){a.PopupFormBlock.open("add",function(e,t){if(e)return!1;a.triggerEvent("add",t,function(){a.addEventCallBack.apply(a,arguments)})})})}},{key:"setBtnEvent",value:function(e,t,a){var n=this;e.on("click","[".concat(t,"]"),function(e){var t=e.target.dataset.action;switch(t){case"edit":n.setEditHandler(e,t,a);break;case"delete":n.setDeleteHandler(e,a)}})}},{key:"setEditHandler",value:function(n,e,r){var l=this,t=JSON.parse(JSON.stringify(n.delegateTarget[r]));this.PopupFormBlock.open(e,t,function(e,t){if(e)return!1;l.triggerEvent("edit",t,function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];l.editEventCallBack.apply(l,t.concat([n.delegateTarget,r]))})})}},{key:"setDeleteHandler",value:function(n,e){var r=this;this.triggerEvent("delete",n.delegateTarget[e],function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];r.deleteEventCallBack.apply(r,t.concat([n.delegateTarget]))})}},{key:"setSelectorEvent",value:function(){var t=this;this.SelectorBlock.subscribe(function(e){t.triggerGetEvent(e,t.calculatePadding(e,t.calculatePages(void 0,e)),function(){t.getEventCallBack.apply(t,arguments),t.PageControllerBlock.setPageBlock(void 0,t.calculatePages())})})}},{key:"setPageEvent",value:function(){var n=this;this.PageControllerBlock.subscribe(function(e,a){n.triggerGetEvent(n.SelectorBlock.getSetValue(),n.calculatePadding(void 0,e),function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(e)return n.getEventCallBack(e),a(e),!1;n.getEventCallBack(e,t),a(e,n.calculatePages())})})}},{key:"getEventCallBack",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(this.block.removeClass("loading"),e||void 0===t.dbLength)return!1;this.dbLength=t.dbLength,this.createBody(t.data)}},{key:"addEventCallBack",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(e)return!1;this.dbLength+=1,this.addToBody(t),this.normalizeTable()}},{key:"editEventCallBack",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=2<arguments.length?arguments[2]:void 0;a[3<arguments.length?arguments[3]:void 0]=t,this.updateBody($(a),t)}},{key:"deleteEventCallBack",value:function(e){1<arguments.length&&void 0!==arguments[1]&&arguments[1];var t=2<arguments.length?arguments[2]:void 0;if(e)return!1;this.dbLength-=1,this.deleteFromBody(t),this.normalizeTable()}},{key:"triggerTableCreate",value:function(){this.loader&&(this.loader.wrapperLoader.addClass("loaded"),this.loader.wrapperTable.addClass("loaded"))}},{key:"on",value:function(e,t){this.eventListner.has(e)?this.eventListner.get(e).push(t):this.eventListner.set(e,[t])}},{key:"off",value:function(e,t){if(eventListner.has(e))for(var a=this.eventListner.get(e),n=0;n<a.length;n++)a[n]===t&&a.splice(n--,1)}}]),f}();exports.default=TableController;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL21vZHVsZS90YWJsZUNvbnRyb2xsZXIuanMiXSwibmFtZXMiOlsiX2N1c3RvbVNlbGVjdG9yIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfcGFnZUNvbnRyb2xsZXIiLCJfcG9wdXBGb3JtIiwiVGFibGVDb250cm9sbGVyIiwiX3JlZiIsInNlbGVjdG9yIiwicGFnZXMiLCJlZGl0Rm9ybSIsImJsb2NrIiwibG9hZGVyIiwiX3JlZiRhZGRCdXR0b24iLCJhZGRCdXR0b24iLCJzY2hlbWEiLCJfcmVmJGRiTGVuZ3RoIiwiZGJMZW5ndGgiLCJfcmVmJGRhdGEiLCJkYXRhIiwiY29ubmVjdG9yIiwiX2NsYXNzQ2FsbENoZWNrIiwidGhpcyIsIlNlbGVjdG9yQmxvY2siLCJDdXN0b21Ecm9wRG93blNlbGVjdG9yIiwibWF4UGFnZXMiLCJjYWxjdWxhdGVQYWdlcyIsIlBhZ2VDb250cm9sbGVyQmxvY2siLCJQYWdlQ29udHJvbGxlciIsIlBvcHVwRm9ybUJsb2NrIiwiUG9wdXBGb3JtIiwiTWFwIiwic2V0U2VsZWN0b3JFdmVudCIsImNyZWF0ZUhlYWQiLCJjcmVhdGVCb2R5IiwidHJpZ2dlclRhYmxlQ3JlYXRlIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwic3RlcCIsImdldFNldFZhbHVlIiwiQ3VycmVudFBvc2l0aW9uIiwiZmluZCIsIl9zdGVwIiwiX2l0ZXJhdG9yIiwiY29sdW1ucyIsIlN5bWJvbCIsIml0ZXJhdG9yIiwiX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiIsIm5leHQiLCJkb25lIiwidmFsdWUiLCJldmVudExpc3RuZXIiLCJjbGFzcyIsImhlYWQiLCJjcmVhdGUiLCJodG1sIiwib2JqZWN0IiwicGF0aCIsIkFycmF5IiwiaXNBcnJheSIsIl9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yIiwiX2RpZEl0ZXJhdG9yRXJyb3IyIiwiX2l0ZXJhdG9yRXJyb3IyIiwiX3N0ZXAyIiwiX2l0ZXJhdG9yMiIsInJlc3VsdCIsImVyciIsInJldHVybiIsIk1hdGgiLCJnZW5lcmF0ZUJvZHkiLCJhcHBlbmQiLCJyZW1vdmUiLCJpIiwidGFyZ2V0IiwiY29uY2F0IiwidGV4dCIsImdldFJlbGF0ZWREYXRhIiwicmVsYXRlZERhdGEiLCJfdGhpcyIsImxpbmtWYXJpYWJsZU5hbWUiLCJzZXRWYWx1ZSIsImVsZW1lbnQiLCJpbmRleCIsImNvbHVtbiIsImF1dG9JbmNyZW1lbnQiLCJidXR0b25zIiwidGVtcCIsImJ1dHRvbkxpbmsiLCJhY3Rpb24iLCJuYW1lIiwidHIiLCJmcmFnbWVudCIsImRvY3VtZW50IiwiY3JlYXRlRG9jdW1lbnRGcmFnbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMyIsIl9kaWRJdGVyYXRvckVycm9yMyIsIl9pdGVyYXRvckVycm9yMyIsIl9zdGVwMyIsIl9pdGVyYXRvcjMiLCJpbm5lckhUTUwiLCJzZXRCdG5FdmVudCIsIiQiLCJhcHBlbmRDaGlsZCIsInRhYmxlIiwiaW5jIiwiZWFjaCIsImV2ZW50IiwiX3N0ZXA0IiwiX2l0ZXJhdG9yNCIsImdldCIsIl9pdGVyYXRvck5vcm1hbENvbXBsZXRpb240IiwiYXBwbHkiLCJhcmdzIiwicGFkZGluZyIsImNiIiwiaGFzIiwiYWRkQ2xhc3MiLCJfdGhpczIiLCJvbiIsIm9wZW4iLCJlcnJvciIsImFuc3dlciIsInRyaWdnZXJFdmVudCIsInZhcmlhYmxlIiwiX3RoaXMzIiwiZGF0YXNldCIsInNldEVkaXRIYW5kbGVyIiwic2V0RGVsZXRlSGFuZGxlciIsIl90aGlzNCIsIm9iaiIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsImRlbGVnYXRlVGFyZ2V0IiwiX2xlbjIiLCJfa2V5MiIsImVkaXRFdmVudENhbGxCYWNrIiwiX3RoaXM1IiwiX2xlbjMiLCJfa2V5MyIsImRlbGV0ZUV2ZW50Q2FsbEJhY2siLCJfdGhpczYiLCJzdWJzY3JpYmUiLCJ0cmlnZ2VyR2V0RXZlbnQiLCJjYWxjdWxhdGVQYWRkaW5nIiwiZ2V0RXZlbnRDYWxsQmFjayIsInNldFBhZ2VCbG9jayIsInBhZ2UiLCJfdGhpczciLCJyZW1vdmVDbGFzcyIsImFkZFRvQm9keSIsIm5vcm1hbGl6ZVRhYmxlIiwidXBkYXRlQm9keSIsImRlbGV0ZUZyb21Cb2R5Iiwid3JhcHBlckxvYWRlciIsIndyYXBwZXJUYWJsZSIsImZ1bmMiLCJwdXNoIiwic2V0IiwiYXJyIiwic3BsaWNlIl0sIm1hcHBpbmdzIjoiQUFBQSwyRkFFQSxJQUFBQSxnQkFBQUMsdUJBQUFDLFFBQUEsaUNBQ0FDLGdCQUFBRix1QkFBQUMsUUFBQSxpQ0FDQUUsV0FBQUgsdUJBQUFDLFFBQUEsOGVBRXFCRywyQkFKckIsU0FBQUEsRUFBQUMsR0FBQSxJQUFBQyxFQUFBRCxFQUFBQyxTQUFBQyxFQUFBRixFQUFBRSxNQUFBQyxFQUFBSCxFQUFBRyxTQUFBQyxFQUFBSixFQUFBSSxNQUFBQyxFQUFBTCxFQUFBSyxPQUFBQyxFQUFBTixFQUFBTyxVQUFBQSxPQUFBLElBQUFELEdBQUFBLEVBQUFFLEVBQUFSLEVBQUFRLE9BQUFDLEVBQUFULEVBQUFVLFNBQUFBLE9BQUEsSUFBQUQsRUFBQSxFQUFBQSxFQUFBRSxFQUFBWCxFQUFBWSxLQUFBQSxPQUFBLElBQUFELEVBQUEsR0FBQUEsRUFBQUUsRUFBQWIsRUFBQWEsVUFBQUMsZ0JBQUFDLEtBQUFoQixHQU1RZ0IsS0FBS2QsU0FBV0EsRUFMeEJjLEtBQUFiLE1BQUFBLEVBT1FhLEtBQUtaLFNBQVdBLEVBTnhCWSxLQUFBWCxNQUFBQSxFQVFRVyxLQUFLVixPQUFTQSxFQUNkVSxLQUFLUixVQUFZQSxFQUNqQlEsS0FBS1AsT0FBU0EsRUFDZE8sS0FBS0wsU0FBV0EsRUFDaEJLLEtBQUtILEtBQU9BLEVBRVpHLEtBQUtDLGNBQWdCLElBQUlDLGdCQUFBQSxRQUF1QkYsS0FBS2QsVUFDckRjLEtBQUtiLE1BQU1nQixTQUFXSCxLQUFLSSxpQkFDM0JKLEtBQUtLLG9CQUFzQixJQUFJQyxnQkFBQUEsUUFBZU4sS0FBS2IsT0FFL0Nh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QXBCYixHQUFBbUQsS0FBZ0NELEdBeUhoQ3hJLEtBQUs4QixhQUFhNEcsSUFBSXBELEVBQU8sQ0FBQ2tELGdDQWxIN0JsRCxFQVBEa0QsR0FESCxHQUFBMUcsYUFBQWlFLElBQUFULEdBa0lHLElBeEhQLElBQUFxRCxFQUFBM0ksS0FBQThCLGFBQUEyRCxJQUFBSCxHQXdIZW5DLEVBQUksRUFBR0EsRUFBSXdGLEVBQUk1SCxPQUFRb0MsSUFDdkJ3RixFQUFJeEYsS0FBT3FGLEdBdkhZRyxFQUFBQyxPQUFBekYsSUFBQSIsImZpbGUiOiJqcy9tb2R1bGUvdGFibGVDb250cm9sbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuaW1wb3J0IEN1c3RvbURyb3BEb3duU2VsZWN0b3IgZnJvbSAnL2pzL21vZHVsZS9jdXN0b21TZWxlY3Rvci5qcyc7XHJcbmltcG9ydCBQYWdlQ29udHJvbGxlciBmcm9tICcvanMvbW9kdWxlL3BhZ2VDb250cm9sbGVyLmpzJztcclxuaW1wb3J0IFBvcHVwRm9ybSBmcm9tICcvanMvbW9kdWxlL3BvcHVwRm9ybS5qcyc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUYWJsZUNvbnRyb2xsZXIge1xyXG4gICAgY29uc3RydWN0b3IgKHtzZWxlY3RvciwgcGFnZXMsIGVkaXRGb3JtLCBibG9jaywgbG9hZGVyLCBhZGRCdXR0b24gPSBmYWxzZSwgc2NoZW1hLCBkYkxlbmd0aCA9IDAsIGRhdGEgPSBbXSwgY29ubmVjdG9yfSkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0b3IgPSBzZWxlY3RvcjtcclxuICAgICAgICB0aGlzLnBhZ2VzID0gcGFnZXM7XHJcbiAgICAgICAgdGhpcy5lZGl0Rm9ybSA9IGVkaXRGb3JtO1xyXG4gICAgICAgIHRoaXMuYmxvY2sgPSBibG9jaztcclxuICAgICAgICB0aGlzLmxvYWRlciA9IGxvYWRlcjtcclxuICAgICAgICB0aGlzLmFkZEJ1dHRvbiA9IGFkZEJ1dHRvbjtcclxuICAgICAgICB0aGlzLnNjaGVtYSA9IHNjaGVtYTtcclxuICAgICAgICB0aGlzLmRiTGVuZ3RoID0gZGJMZW5ndGg7XHJcbiAgICAgICAgdGhpcy5kYXRhID0gZGF0YTtcclxuXHJcbiAgICAgICAgdGhpcy5TZWxlY3RvckJsb2NrID0gbmV3IEN1c3RvbURyb3BEb3duU2VsZWN0b3IodGhpcy5zZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5wYWdlcy5tYXhQYWdlcyA9IHRoaXMuY2FsY3VsYXRlUGFnZXMoKTtcclxuICAgICAgICB0aGlzLlBhZ2VDb250cm9sbGVyQmxvY2sgPSBuZXcgUGFnZUNvbnRyb2xsZXIodGhpcy5wYWdlcyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKHRoaXMuZWRpdEZvcm0pIHtcclxuICAgICAgICAgICAgdGhpcy5lZGl0Rm9ybS5jb25uZWN0b3IgPSBjb25uZWN0b3I7XHJcbiAgICAgICAgICAgIHRoaXMuUG9wdXBGb3JtQmxvY2sgPSBuZXcgUG9wdXBGb3JtKHRoaXMuZWRpdEZvcm0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5ldmVudExpc3RuZXIgPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgdGhpcy5zZXRTZWxlY3RvckV2ZW50KCk7XHJcbiAgICAgICAgdGhpcy5zZXRQYWdlRXZlbnQoKTtcclxuXHJcbiAgICAgICAgdGhpcy5jcmVhdGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGUoKSB7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVIZWFkKCk7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVCb2R5KCk7XHJcbiAgICAgICAgdGhpcy5zZXRBZGRFdmVudCgpO1xyXG5cclxuICAgICAgICB0aGlzLnRyaWdnZXJUYWJsZUNyZWF0ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNhbGN1bGF0ZVBhZ2VzKGxlbmd0aCA9IHRoaXMuZGJMZW5ndGgsIHN0ZXAgPSB0aGlzLlNlbGVjdG9yQmxvY2suZ2V0U2V0VmFsdWUoKSkge1xyXG4gICAgICAgIHJldHVybiBNYXRoLmNlaWwobGVuZ3RoIC8gc3RlcCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2FsY3VsYXRlUGFkZGluZyhsZW5ndGggPSB0aGlzLlNlbGVjdG9yQmxvY2suZ2V0U2V0VmFsdWUoKSwgcGFnZSA9IHRoaXMuUGFnZUNvbnRyb2xsZXJCbG9jay5DdXJyZW50UG9zaXRpb24pIHtcclxuICAgICAgICByZXR1cm4gKHBhZ2UgLSAxKSAqIGxlbmd0aDtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVIZWFkICgpIHtcclxuICAgICAgICBpZiAodGhpcy5ibG9jay5maW5kKFwidGhlYWRcIikubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5ibG9jay5odG1sKFwiPHRoZWFkPjwvdGhlYWQ+XCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGhlYWQgPSB0aGlzLmJsb2NrLmZpbmQoXCJ0aGVhZFwiKSxcclxuICAgICAgICAgICAgaHRtbCA9IFwiXCI7XHJcblxyXG4gICAgICAgIGZvcihsZXQgYmxvY2sgb2YgdGhpcy5zY2hlbWEuY29sdW1ucykge1xyXG4gICAgICAgICAgICBodG1sICs9IGA8dGQgY2xhc3M9XCIke2Jsb2NrLmNsYXNzIHx8IFwiXCJ9XCI+JHtibG9jay52YWx1ZX08L3RkPmA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBoZWFkLmh0bWwoaHRtbCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0UmVsYXRlZERhdGEob2JqZWN0LCBwYXRoKSB7XHJcbiAgICAgICAgaWYoIUFycmF5LmlzQXJyYXkocGF0aCkpXHJcbiAgICAgICAgICAgIHJldHVybiBvYmplY3RbcGF0aF07XHJcblxyXG4gICAgICAgIGxldCByZXN1bHQgPSBvYmplY3Q7XHJcblxyXG4gICAgICAgIGZvcihsZXQgZWwgb2YgcGF0aCkge1xyXG4gICAgICAgICAgICByZXN1bHQgPSByZXN1bHRbZWxdIHx8IFwiXCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUJvZHkoZGF0YSkge1xyXG4gICAgICAgIHRoaXMuYmxvY2suZmluZChcInRib2R5XCIpLmh0bWwoIHRoaXMuZ2VuZXJhdGVCb2R5KGRhdGEpICk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkVG9Cb2R5KGRhdGEpIHtcclxuICAgICAgICB0aGlzLmJsb2NrLmZpbmQoXCJ0Ym9keVwiKS5hcHBlbmQoIHRoaXMuZ2VuZXJhdGVCb2R5KFtkYXRhXSkgKTtcclxuICAgIH1cclxuXHJcbiAgICBkZWxldGVGcm9tQm9keShkYXRhKSB7XHJcbiAgICAgICAgZGF0YS5yZW1vdmUoKTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVCb2R5KHRhcmdldCwgb2JqZWN0KSB7XHJcbiAgICAgICAgbGV0IHNjaGVtYSA9IHRoaXMuc2NoZW1hLmNvbHVtbnM7XHJcblxyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzY2hlbWEubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKHNjaGVtYVtpXS5yZWxhdGVkRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0LmZpbmQoYHRkOmVxKCR7aX0pYCkudGV4dCggdGhpcy5nZXRSZWxhdGVkRGF0YShvYmplY3QsIHNjaGVtYVtpXS5yZWxhdGVkRGF0YSkgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZW5lcmF0ZUJvZHkgKGRhdGEgPSB0aGlzLmRhdGEpIHtcclxuICAgICAgICBpZiAoZGF0YSA9PT0gdW5kZWZpbmVkIHx8IGRhdGEubGVuZ3RoID09PSAwKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgIGxldCBsaW5rVmFyaWFibGVOYW1lID0gXCJyZWxhdGVkRWxlbWVudFwiLFxyXG4gICAgICAgICAgICBzZXRWYWx1ZSA9IChlbGVtZW50LCBpbmRleCwgY29sdW1uLCBzY2hlbWEpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChjb2x1bW4uYXV0b0luY3JlbWVudClcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5kZXggKyAxO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChjb2x1bW4uYnV0dG9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCB0ZW1wID0gXCJcIjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2x1bW4uYnV0dG9ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgYnV0dG9uTGluayA9IHNjaGVtYS5idXR0b25zW2NvbHVtbi5idXR0b25zW2ldXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAgKz0gYDxkaXYgY2xhc3M9XCIke2J1dHRvbkxpbmsuY2xhc3N9XCIgZGF0YS1hY3Rpb249XCIke2J1dHRvbkxpbmsuYWN0aW9ufVwiPiR7YnV0dG9uTGluay5uYW1lfTwvZGl2PmA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGVtcDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoY29sdW1uLnJlbGF0ZWREYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFJlbGF0ZWREYXRhKGVsZW1lbnQsIGNvbHVtbi5yZWxhdGVkRGF0YSk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmJsb2NrLmZpbmQoXCJ0Ym9keVwiKS5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmJsb2NrLmh0bWwoXCI8dGJvZHk+PC90Ym9keT5cIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksXHJcbiAgICAgICAgICAgIHRyO1xyXG5cclxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBsZXQgZWxlbWVudCAgPSBkYXRhW2ldLFxyXG4gICAgICAgICAgICAgICAgaHRtbCA9IFwiXCI7XHJcblxyXG4gICAgICAgICAgICB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0clwiKTtcclxuICAgICAgICAgICAgdHJbbGlua1ZhcmlhYmxlTmFtZV0gPSBlbGVtZW50O1xyXG5cclxuICAgICAgICAgICAgZm9yKGxldCBjb2x1bW4gb2YgdGhpcy5zY2hlbWEuY29sdW1ucykge1xyXG4gICAgICAgICAgICAgICAgaHRtbCArPSBgPHRkIGNsYXNzPVwiJHtcclxuICAgICAgICAgICAgICAgICAgICBjb2x1bW4uY2xhc3MgfHwgXCJcIlxyXG4gICAgICAgICAgICAgICAgfVwiICR7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uLnJlbGF0ZWREYXRhID8gYGRhdGEtdGl0bGU9XCIke2NvbHVtbi52YWx1ZX1cImAgOiBcIlwiXHJcbiAgICAgICAgICAgICAgICB9PiR7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VmFsdWUoZWxlbWVudCwgaSwgY29sdW1uLCB0aGlzLnNjaGVtYSlcclxuICAgICAgICAgICAgICAgIH08L3RkPmA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRyLmlubmVySFRNTCA9IGh0bWw7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0QnRuRXZlbnQoJCh0ciksIFwiZGF0YS1hY3Rpb25cIiwgbGlua1ZhcmlhYmxlTmFtZSlcclxuICAgICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQodHIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZyYWdtZW50O1xyXG4gICAgfVxyXG5cclxuICAgIG5vcm1hbGl6ZVRhYmxlKCkge1xyXG4gICAgICAgIGxldCB0YWJsZSA9IHRoaXMuYmxvY2suZmluZChcInRib2R5XCIpLFxyXG4gICAgICAgICAgICBzY2hlbWEgPSB0aGlzLnNjaGVtYS5jb2x1bW5zO1xyXG5cclxuXHJcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHNjaGVtYS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiggc2NoZW1hW2ldLmF1dG9JbmNyZW1lbnQgKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgaW5jID0gMTtcclxuXHJcbiAgICAgICAgICAgICAgICB0YWJsZS5maW5kKGB0ciA+IHRkOmZpcnN0LWNoaWxkYCkuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS50ZXh0KGluYysrKVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdHJpZ2dlckV2ZW50KGV2ZW50LCAuLi5hcmdzKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmV2ZW50TGlzdG5lci5oYXMoZXZlbnQpKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgIGZvcihsZXQgY3VycmVudCBvZiB0aGlzLmV2ZW50TGlzdG5lci5nZXQoZXZlbnQpKSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnQoLi4uYXJncylcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdHJpZ2dlckdldEV2ZW50KGxlbmd0aCwgcGFkZGluZywgY2IpIHtcclxuICAgICAgICBsZXQgZXZlbnQgPSBcImdldFwiO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZXZlbnRMaXN0bmVyLmhhcyhldmVudCkpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgdGhpcy5ibG9jay5hZGRDbGFzcyhcImxvYWRpbmdcIik7XHJcbiAgICAgICAgdGhpcy50cmlnZ2VyRXZlbnQoZXZlbnQsIHtsZW5ndGgsIHBhZGRpbmd9LCBjYik7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0QWRkRXZlbnQoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmFkZEJ1dHRvbikgXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgIHRoaXMuYWRkQnV0dG9uLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLlBvcHVwRm9ybUJsb2NrLm9wZW4oXCJhZGRcIiwgKGVycm9yLCBhbnN3ZXIpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChlcnJvcilcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyRXZlbnQoXCJhZGRcIiwgYW5zd2VyLCAoLi4uYXJncykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkRXZlbnRDYWxsQmFjayguLi5hcmdzKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0QnRuRXZlbnQoYmxvY2ssIHNlbGVjdG9yLCB2YXJpYWJsZSkge1xyXG4gICAgICAgIGxldCBwb3B1cEZvcm1FdmVudEhhbmRsZXIgPSAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgbGV0IGFjdGlvbiA9IGV2ZW50LnRhcmdldC5kYXRhc2V0LmFjdGlvbjtcclxuXHJcbiAgICAgICAgICAgIHN3aXRjaCAoYWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiZWRpdFwiOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RWRpdEhhbmRsZXIoZXZlbnQsIGFjdGlvbiwgdmFyaWFibGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcImRlbGV0ZVwiOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RGVsZXRlSGFuZGxlcihldmVudCwgdmFyaWFibGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGJsb2NrLm9uKFwiY2xpY2tcIiwgYFske3NlbGVjdG9yfV1gLCBwb3B1cEZvcm1FdmVudEhhbmRsZXIpOyAgIFxyXG4gICAgfVxyXG5cclxuICAgIHNldEVkaXRIYW5kbGVyKGV2ZW50LCBhY3Rpb24sIHZhcmlhYmxlKSB7XHJcbiAgICAgICAgLy8gbGV0IG9iaiA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbihvYmosICk7XHJcblxyXG4gICAgICAgIGxldCBvYmogPSBKU09OLnBhcnNlKCBKU09OLnN0cmluZ2lmeShldmVudC5kZWxlZ2F0ZVRhcmdldFt2YXJpYWJsZV0pICk7XHJcblxyXG4gICAgICAgIHRoaXMuUG9wdXBGb3JtQmxvY2sub3BlbihhY3Rpb24sIG9iaiwgKGVycm9yLCBhbnN3ZXIpID0+IHtcclxuICAgICAgICAgICAgaWYgKGVycm9yKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgdGhpcy50cmlnZ2VyRXZlbnQoXCJlZGl0XCIsIGFuc3dlciwgKC4uLmFyZ3MpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWRpdEV2ZW50Q2FsbEJhY2soLi4uYXJncywgZXZlbnQuZGVsZWdhdGVUYXJnZXQsIHZhcmlhYmxlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0RGVsZXRlSGFuZGxlcihldmVudCwgdmFyaWFibGUpIHtcclxuICAgICAgICB0aGlzLnRyaWdnZXJFdmVudChcImRlbGV0ZVwiLCBldmVudC5kZWxlZ2F0ZVRhcmdldFt2YXJpYWJsZV0sICguLi5hcmdzKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZGVsZXRlRXZlbnRDYWxsQmFjayguLi5hcmdzLCBldmVudC5kZWxlZ2F0ZVRhcmdldCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0U2VsZWN0b3JFdmVudCgpIHtcclxuICAgICAgICB0aGlzLlNlbGVjdG9yQmxvY2suc3Vic2NyaWJlKChsZW5ndGgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy50cmlnZ2VyR2V0RXZlbnQobGVuZ3RoLCB0aGlzLmNhbGN1bGF0ZVBhZGRpbmcobGVuZ3RoLCB0aGlzLmNhbGN1bGF0ZVBhZ2VzKHVuZGVmaW5lZCwgbGVuZ3RoKSksICguLi5hcmdzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldEV2ZW50Q2FsbEJhY2soLi4uYXJncyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLlBhZ2VDb250cm9sbGVyQmxvY2suc2V0UGFnZUJsb2NrKHVuZGVmaW5lZCwgdGhpcy5jYWxjdWxhdGVQYWdlcygpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0UGFnZUV2ZW50KCkge1xyXG4gICAgICAgIHRoaXMuUGFnZUNvbnRyb2xsZXJCbG9jay5zdWJzY3JpYmUoKHBhZ2UsIGNiKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudHJpZ2dlckdldEV2ZW50KHRoaXMuU2VsZWN0b3JCbG9jay5nZXRTZXRWYWx1ZSgpLCB0aGlzLmNhbGN1bGF0ZVBhZGRpbmcodW5kZWZpbmVkLCBwYWdlKSwgKGVycm9yLCByZXN1bHQgPSB7fSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRFdmVudENhbGxCYWNrKGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICBjYihlcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0RXZlbnRDYWxsQmFjayhlcnJvciwgcmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIGNiKGVycm9yLCB0aGlzLmNhbGN1bGF0ZVBhZ2VzKCkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRFdmVudENhbGxCYWNrKGVycm9yLCByZXN1bHQgPSB7fSkge1xyXG4gICAgICAgIHRoaXMuYmxvY2sucmVtb3ZlQ2xhc3MoXCJsb2FkaW5nXCIpO1xyXG5cclxuICAgICAgICBpZiAoZXJyb3IgfHwgcmVzdWx0LmRiTGVuZ3RoID09PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgdGhpcy5kYkxlbmd0aCA9IHJlc3VsdC5kYkxlbmd0aDtcclxuICAgICAgICB0aGlzLmNyZWF0ZUJvZHkocmVzdWx0LmRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZEV2ZW50Q2FsbEJhY2soZXJyb3IsIHJlc3VsdCA9IHt9KSB7XHJcbiAgICAgICAgaWYgKGVycm9yKVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgIHRoaXMuZGJMZW5ndGggKz0gMTtcclxuICAgICAgICB0aGlzLmFkZFRvQm9keShyZXN1bHQpO1xyXG4gICAgICAgIHRoaXMubm9ybWFsaXplVGFibGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBlZGl0RXZlbnRDYWxsQmFjayhlcnJvciwgcmVzdWx0ID0ge30sIGJsb2NrLCB2YXJpYWJsZSkge1xyXG4gICAgICAgIGJsb2NrW3ZhcmlhYmxlXSA9IHJlc3VsdDtcclxuICAgICAgICB0aGlzLnVwZGF0ZUJvZHkoJChibG9jayksIHJlc3VsdCk7XHJcbiAgICB9XHJcblxyXG4gICAgZGVsZXRlRXZlbnRDYWxsQmFjayhlcnJvciwgcmVzdWx0ID0ge30sIGJsb2NrKSB7XHJcbiAgICAgICAgaWYgKGVycm9yKVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgIHRoaXMuZGJMZW5ndGggLT0gMTtcclxuICAgICAgICB0aGlzLmRlbGV0ZUZyb21Cb2R5KGJsb2NrKTtcclxuICAgICAgICB0aGlzLm5vcm1hbGl6ZVRhYmxlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdHJpZ2dlclRhYmxlQ3JlYXRlKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5sb2FkZXIpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgdGhpcy5sb2FkZXIud3JhcHBlckxvYWRlci5hZGRDbGFzcyhcImxvYWRlZFwiKTtcclxuICAgICAgICB0aGlzLmxvYWRlci53cmFwcGVyVGFibGUuYWRkQ2xhc3MoXCJsb2FkZWRcIik7XHJcbiAgICB9XHJcblxyXG4gICAgb24oZXZlbnQsIGZ1bmMpIHtcclxuICAgICAgICBpZiAodGhpcy5ldmVudExpc3RuZXIuaGFzKGV2ZW50KSkge1xyXG4gICAgICAgICAgICB0aGlzLmV2ZW50TGlzdG5lci5nZXQoZXZlbnQpLnB1c2goZnVuYyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5ldmVudExpc3RuZXIuc2V0KGV2ZW50LCBbZnVuY10pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvZmYoZXZlbnQsIGZ1bmMpIHtcclxuICAgICAgICBpZiAoZXZlbnRMaXN0bmVyLmhhcyhldmVudCkpIHtcclxuICAgICAgICAgICAgbGV0IGFyciA9IHRoaXMuZXZlbnRMaXN0bmVyLmdldChldmVudCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYXJyW2ldID09PSBmdW5jKSBcclxuICAgICAgICAgICAgICAgICAgICBhcnIuc3BsaWNlKGktLSwgMSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSJdfQ==
